<!-- templates/index.html -->
<!DOCTYPE html>
<html lang="id">
<head>
    <!-- Existing head content -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hacker Terminal - AI Narratives Index</title>
    <!-- Include Chart.js from CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Include Solana Web3.js untuk koneksi wallet -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/@solana/web3.js/1.30.2/web3.min.js" integrity="sha512-+0VhCmDA8l7HNj6tXMmAEEAOfqFFx5JUG4Y5X9E44QlG+hVlyHb8Lz4GPK5yxgfT6Jd+BSR6ewGlkE3GAtwGpg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <style>
        /* Existing styles */
        body {
            background-color: black;
            color: lime;
            font-family: 'Courier New', Courier, monospace;
            margin: 0;
            padding: 0;
        }
        .container {
            display: flex;
            flex-direction: column;
            height: 100vh;
            display: none; /* Initially hidden until loading completes */
        }
        .content {
            display: flex;
            flex: 1;
            padding: 10px;
        }
        .box {
            margin: 10px;
            border: 1px solid lime;
            padding: 10px;
            overflow-y: auto;
            background-color: #111; /* Optional: Add a slightly different background for better separation */
        }
        .left-box {
            flex: 1;
        }
        .center-box {
            flex: 2;
            display: flex;
            flex-direction: column;
            align-items: center; /* Center content horizontally */
            justify-content: center; /* Center content vertically */
        }
        .right-box {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 10px; /* Add space between the two boxes */
            border: none !important; /* Menghilangkan border */
            padding: 0 !important; /* Menghilangkan padding */
            margin: 0px !important;
            background-color: transparent; 
        }
        .input-box {
            border-top: 1px solid lime;
            padding: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: #000; /* Optional: Add background color */
            position: relative; /* For positioning the suggestion dropdown */
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            border: 1px solid lime;
            padding: 5px;
            text-align: left;
        }
        th {
            font-weight: bold;
        }
        img {
            max-width: 100%;
            height: auto;
            display: block;
            margin: 0 auto;
        }
        ul {
            list-style-type: none;
            padding: 0;
            max-height: 300px; /* Adjust as needed */
            overflow-y: auto;
        }
        li {
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            justify-content: space-between; /* Changed to space-between */
        }
        .compare-checkbox {
            margin-right: 10px;
        }
        .show-plot-btn {
            background: none;
            border: none;
            color: lime;
            cursor: pointer;
            font-size: 16px;
            margin-left: auto; /* Push the button to the far right */
        }
        .show-plot-btn:hover {
            color: white;
        }
        /* Flash message styles */
        .flash {
            padding: 10px;
            margin: 10px;
            border: 1px solid;
            border-radius: 5px;
        }
        .flash-error {
            background-color: #ffdddd;
            border-color: #ff5c5c;
            color: #a70000;
        }
        .flash-info {
            background-color: #ddffdd;
            border-color: #5cff5c;
            color: #007a00;
        }

        /* Loading Screen Styles */
        #loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: black;
            color: lime;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            z-index: 9999; /* Ensure it overlays everything */
            font-family: 'Courier New', Courier, monospace;
        }

        /* Typing Animation */
        .typing {
            border-right: 0.15em solid lime;
            white-space: nowrap;
            overflow: hidden;
            animation: blink-caret 0.75s step-end infinite;
        }

        @keyframes blink-caret {
            from, to { border-color: transparent; }
            50% { border-color: lime; }
        }

        /* Progress Bar Styles */
        #progress-container {
            width: 80%;
            background-color: #333;
            border-radius: 5px;
            margin-top: 20px;
        }

        #progress-bar {
            width: 0%;
            height: 20px;
            background-color: lime;
            border-radius: 5px;
            transition: width 0.5s ease;
        }

        /* Additional Styles for Time Labels */
        .time-since {
            font-size: 0.9em;
            color: #aaffaa;
            margin-left: 10px;
        }

        /* Styles for the Charts */
        #chart-container {
            position: relative;
            width: 100%;
            max-width: 600px; /* Limit the maximum width */
            height: 400px; /* Fixed height to maintain consistency */
            background-color: transparent; /* Ensure background is transparent */
            margin: 0 auto; /* Center the chart horizontally */
        }
        #tweetChart {
            width: 100%;
            height: 100%;
        }
        #chart-legend {
            margin-top: 10px;
            display: flex;
            flex-wrap: wrap;
            justify-content: center; /* Center the legend */
        }
        .legend-item {
            display: flex;
            align-items: center;
            margin-right: 15px;
            margin-bottom: 5px;
        }
        .legend-color {
            width: 12px;
            height: 12px;
            margin-right: 5px;
            border: 1px solid lime;
        }

        /* Styles for Chart Type Selector */
        .chart-type-selector {
            margin-bottom: 10px;
            width: 100%;
            max-width: 600px; /* Align with chart container */
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .chart-type-selector label {
            margin-right: 10px;
            color: lime; /* Ensure label text is green */
        }
        .chart-type-selector select {
            background: transparent; /* Transparent background */
            color: lime; /* Green text */
            border: 1px solid lime;
            padding: 5px;
            font-family: 'Courier New', Courier, monospace;
            cursor: pointer;
        }
        .chart-type-selector select option {
            background: black; /* Match the background */
            color: lime; /* Green text */
        }

        /* Styles for Connect Wallet Section */
        .wallet-section {
            /* Remove existing border-bottom to avoid double borders */
            /* border-bottom: 1px solid lime; */
        }
        .wallet-button {
            background: transparent;
            color: lime;
            border: 1px solid lime;
            padding: 5px 10px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s, box-shadow 0.3s;
        }
        .wallet-button:hover {
            border: 1px solid #aaff00;
            background: lime;
            color:black;
        }
        .wallet-address {
            margin-top: 10px;
            font-size: 14px;
            color: #aaffaa;
            word-break: break-all;
        }
        .profile-icon {
            width: 40px;
            height: 40px;
            background-color: transparent;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: lime;
            font-weight: bold;
            margin-right: 10px;
        }
        .wallet-container {
            display: flex;
            align-items: center;
        }
        .retro-point {
            margin-left: 10px;
            font-size: 14px;
            color: #aaffaa;
        }

        /* Styles for Enhanced Search Bar */
        .search-form {
            width: 100%;
            max-width: 800px;
            display: flex;
            align-items: center;
            position: relative; /* For positioning the suggestion dropdown */
        }
        .search-container {
            display: flex;
            align-items: center;
            width: 100%;
            background-color: #111;
            border: 1px solid lime;
            border-radius: 5px;
            padding: 5px 10px;
        }
        .hacker-logo {
            width: 30px;
            height: 30px;
            margin-right: 10px;
        }
        .search-container input {
            flex: 1;
            background: transparent;
            border: none;
            color: lime;
            font-size: 16px;
            outline: none;
        }
        .search-button {
            background-color: lime;
            color: black;
            border: none;
            padding: 10px 20px;
            cursor: pointer;
            border-radius: 3px;
            font-family: 'Courier New', Courier, monospace;
            font-size: 16px;
            transition: background-color 0.3s, box-shadow 0.3s;
        }
        .search-button:hover {
            background-color: #aaff00;
            box-shadow: 0 0 10px lime;
        }

        /* Styles for Search Suggestions */
        .suggestions {
            position: absolute;
            top: 100%; /* Position below the search input */
            left: 0;
            right: 0;
            background-color: #111;
            border: 1px solid lime;
            max-height: 200px;
            overflow-y: auto;
            z-index: 1000;
        }
        .suggestion-item {
            padding: 8px 10px;
            cursor: pointer;
            color: lime;
            font-family: 'Courier New', Courier, monospace;
            font-size: 14px;
        }
        .suggestion-item:hover {
            background-color: #333;
        }

        /* Pagination Styles */
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-top: 15px;
            gap: 5px;
        }
        .pagination a, .pagination span {
            display: inline-block;
            padding: 5px 10px;
            border: 1px solid lime;
            border-radius: 3px;
            text-decoration: none;
            color: lime;
            cursor: pointer;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            transition: background-color 0.3s, color 0.3s;
        }
        .pagination a:hover {
            background-color: lime;
            color: black;
        }
        .pagination .active {
            background-color: lime;
            color: black;
            cursor: default;
        }
        .pagination .disabled {
            color: #555;
            border-color: #555;
            cursor: not-allowed;
        }

        /* Lock Overlay Styles */
        #lock-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.85);
            display: none; /* Initially hidden */
            justify-content: center;
            align-items: center;
            flex-direction: column;
            z-index: 10000; /* Ensure it overlays everything */
            color: lime;
            font-family: 'Courier New', Courier, monospace;
            text-align: center;
            padding: 20px;
        }

        #lock-overlay img {
            width: 100px;
            height: 100px;
            margin-bottom: 20px;
        }

        #lock-overlay p {
            font-size: 1.2em;
        }

        /* Close Button for Overlay */
        #lock-overlay .close-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: none;
            border: none;
            color: lime;
            font-size: 24px;
            cursor: pointer;
        }
        #lock-overlay .close-btn:hover {
            color: white;
        }

        /* Ensure elements fit within the border */
        * {
            box-sizing: border-box;
        }

        /* System Status Header */
        .system-header {
            text-align: center;
            margin-top: 9px;
            padding: 10px;
            background-color: black;
            border: 2px solid lime;
            border-radius: 5px;
        }

        .system-header h2 {
            font-family: 'Courier New', monospace;
            color: lime;
            margin: 0;
            font-size: 20px;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        /* System Status Box */
        .system-status {
            background-color: #111;
            border: 1px solid lime;
            padding: 10px;
            margin-bottom: 10px; /* Add spacing between boxes */
            font-family: 'Courier New', monospace;
            color: lime;
            text-align: left;
            border-radius: 5px;
        }

        .system-status h3 {
            font-size: 16px;
            margin: 0 0 5px 0;
            text-transform: uppercase;
        }

        .system-status p {
            font-size: 14px;
            margin: 5px 0;
            line-height: 1.4;
        }


        .system-status h3 {
            font-size: 16px;
            margin: 0 0 5px 0;
        }

        .system-status p {
            font-size: 14px;
            margin: 5px 0;
        }


        .loading-container {
            margin: 10px 0;
        }
        .loading-bar {
            width: 100%;
            background-color: #333;
            border: 1px solid lime;
            border-radius: 5px;
            overflow: hidden;
        }
        .loading-progress {
            width: 0%;
            height: 20px;
            background-color: lime;
            text-align: center;
            line-height: 20px;
            color: black;
            transition: width 0.5s ease;
        }
        .api-status {
            margin-top: 10px;
            font-size: 16px;
            color: lime;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
        }

        /* General styles */
        .status-text {
            font-weight: bold;
            font-family: 'Courier New', monospace;
        }

        /* Animation for blinking */
        .blinking-green {
            color: lime;
            animation: blink-green 1s infinite;
        }

        .blinking-yellow {
            color: yellow;
            animation: blink-yellow 1s infinite;
        }

        .blinking-red {
            color: red;
            animation: blink-red 1s infinite;
        }

        /* Green blinking animation */
        @keyframes blink-green {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* Yellow blinking animation */
        @keyframes blink-yellow {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* Red blinking animation */
        @keyframes blink-red {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.2; }
        }
        /* Hacker Header Styles */
        .hacker-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 20px;
            background-color: black;
            border-bottom: 2px solid lime;
        }

        /* Social Media Section */
        .social-media {
            display: flex;
            gap: 15px;
        }

        .social-media a {
            color: lime;
            text-decoration: none;
        }

        .social-media img {
            width: 30px;
            height: 30px;
            transition: transform 0.3s, filter 0.3s;
        }

        .social-media img:hover {
            transform: scale(1.2);
            filter: drop-shadow(0 0 10px lime);
        }

        /* Navigation Menu */
        .hacker-nav ul {
            list-style: none;
            display: flex;
            gap: 20px;
            margin: 0;
            padding: 0;
        }

        .hacker-nav ul li {
            position: relative; /* To position the neon effect */
            display: inline-block;
        }

        .hacker-nav ul li a {
            text-decoration: none;
            color: lime;
            font-family: 'Courier New', Courier, monospace;
            font-size: 16px;
            font-weight: normal; /* Normal weight by default */
            overflow: hidden;
            display: flex;
            padding: 5px 10px;
            align-items: center; /* Posisikan teks dan ikon secara vertikal di tengah */
            position: relative; /* Required for the pseudo-element */
            transition: color 0.3s ease, transform 0.3s ease, font-weight 0.3s ease;
        }

        .hacker-nav ul li a:hover {
            color: white; /* Text color change on hover */
            font-weight: bold; /* Bold text on hover */
        }

        /* Neon Effect */
        .hacker-nav ul li a::before {
            content: "";
            position: absolute;
            left: 0; /* Start at the left */
            bottom: 0;
            width: 0; /* Initially hidden */
            height: 3px; /* Height of the neon line */
            background: linear-gradient(90deg, transparent, lime, transparent); /* Neon gradient */
            transition: width 0.4s ease; /* Smooth animation for the width */
        }

        .hacker-nav ul li a:hover::before {
            width: 100%; /* Expand fully on hover */
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div id="loading-screen">
        <h1>Initializing AI Narratives Index...</h1>
        <div id="terminal-output">
            <p class="typing" id="loading-line">Loading modules...</p>
        </div>
        <div id="progress-container">
            <div id="progress-bar"></div>
        </div>
    </div>

    <!-- Lock Overlay (Initially Hidden) -->
    <div id="lock-overlay">
        <button class="close-btn" id="lock-close-btn">✖️</button>
        <img src="https://img.icons8.com/ios-filled/100/ffffff/lock.png" alt="Lock Icon">
        <p>Access Restricted</p>
        <p>Please connect your wallet to use the search feature.</p>
    </div>

    <!-- Main Content -->
    <div class="container">
        <!-- Flash Messages -->
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                <div class="flash-messages">
                    {% for category, message in messages %}
                        <div class="flash flash-{{ category }}">
                            {{ message }}
                        </div>
                    {% endfor %}
                </div>
            {% endif %}
        {% endwith %}
        <header class="hacker-header">
            <!-- Social Media Icons -->
            <div class="social-media">
                <a href="https://twitter.com/yourprofile" target="_blank" title="Follow on Twitter">
                    Twil<img src="https://img.icons8.com/ios-filled/30/ffffff/twitter.png" alt="Twitter">
                </a>
                <a href="https://github.com/yourprofile" target="_blank" title="Follow on GitHub">
                    <img src="https://img.icons8.com/ios-filled/30/ffffff/github.png" alt="GitHub">
                </a>
            </div>
            <!-- Navigation Menu -->
            <nav class="hacker-nav">
                <ul>
                    <li><a href="/docs"><b>Docs</b>&nbsp;<img src="https://img.icons8.com/ios-filled/30/00ff00/document.png" alt="Docs Icon"></a></li>
                    <li><a href="/"><b>Twitter</b>&nbsp;<img src="https://img.icons8.com/ios-filled/30/00ff00/x.png" alt="X  Icon"></a></li>
                </ul>
            </nav>
        </header>
        <div class="content">
            <!-- Header Section -->
            <!-- System Status Section -->
            <div class="box right-box">
                <!-- System Status Header -->
                <div class="system-header">
                    <h2>+ SYSTEM STATUS +</h2>
                </div>
            
                <!-- CPU Load Section -->
                <div class="box system-status">
                    <h3>CPU Load</h3>
                    <p id="cpu-load">
                        <span class="status-text" id="cpu-load-status">0%</span>
                    </p>
                </div>
            
                <!-- Active Connections Section -->
                <div class="box system-status">
                    <h3>Active Connections</h3>
                    <p id="active-connections">
                        <span class="status-text" id="connections-status">0</span>
                    </p>
                </div>
            
                <!-- AI Engine Section -->
                <div class="box system-status">
                    <h3>AI Engine</h3>
                    <p>Status: <span class="status-text" id="ai-engine-status">[🟢] Operational</span></p>
                    <p>Load: <span class="status-text" id="ai-engine-load">0%</span></p>
                    <p>Response Time: <span class="status-text" id="ai-engine-response-time">0ms</span></p>
                </div>
            
                    <!-- Queue Section -->
                <div class="box system-status">
                    <h3>Queue</h3>
                    <p>Queue Length: <span class="status-text" id="queue-length">0</span></p>
                    <p>Processing Speed: <span class="status-text" id="processing-speed">0ms/item</span></p>
                    <p>Next in Queue: <span class="status-text" id="next-in-queue">None</span></p>
                </div>

            </div>
            
            <div class="box center-box">
                <!-- Moved "Tweet Analytics" and Chart Type Selector to the Top -->
                <h3>Tweet Analytics</h3>
                <!-- Chart Type Selector as Dropdown -->
                <div class="chart-type-selector">
                    <label for="chartTypeSelect">Select Chart Type:</label>
                    <select id="chartTypeSelect">
                        <option value="" disabled selected>Select Chart Type</option> <!-- Placeholder option -->
                        <option value="line">Line Chart</option>
                        <option value="bar">Bar Chart</option>
                        <option value="doughnut">Donut Chart</option>
                    </select>
                </div>
                <!-- Chart.js Canvas -->
                <div id="chart-container">
                    <canvas id="tweetChart"></canvas>
                </div>
                <div id="chart-legend"></div>
            </div>
            <div class="box right-box">
                <!-- Connect Wallet Section -->
                <div class="box wallet-section">
                    <h3>Connect Wallet</h3>
                    <div class="wallet-container">
                        <button class="wallet-button" id="connect-wallet-btn">Connect Wallet ⏻</button>
                        <div class="retro-point" id="retro-point" style="margin-left: 10px;">Retro Point: 0</div>
                    </div>
                    <div class="wallet-address" id="wallet-address" style="display: none;">
                        Connected: <span id="wallet-address-text"></span>
                    </div>
                </div>
                <!-- Popular Searches Section -->
                <div class="box popular-searches-section">
                    <h3>Popular Searches</h3>
                    {% if popular_searches %}
                        <ul>
                            {% for search in popular_searches %}
                                <li>
                                    <!-- Checkbox -->
                                    <div style="flex: 0 0 auto; margin-right: 10px;">
                                        <input type="checkbox" class="compare-checkbox" data-query="{{ search.query }}" id="checkbox-{{ loop.index }}">
                                    </div>
                                    
                                    <!-- Query Name and Count -->
                                    <div style="flex: 1; text-align: left;">
                                        <label for="checkbox-{{ loop.index }}">
                                            {{ search.query }} [🔍{{ search.count }}]
                                        </label>
                                    </div>

                                    <!-- Percentage Change -->
                                    <div style="flex: 0 0 auto; text-align: right;">
                                        <span>
                                            {{ search.percentage_change }}%
                                            {% if search.trend == 'up' %}
                                                🔼
                                            {% elif search.trend == 'down' %}
                                                🔻
                                            {% else %}
                                                ➖
                                            {% endif %}
                                        </span>
                                    </div>
                                </li>
                            {% endfor %}
                        </ul>

                        <!-- Pagination Controls for Popular Searches -->
                        <div class="pagination">
                            {% if popular_page > 1 %}
                                <a href="{{ url_for('index', popular_page=popular_page-1, recent_page=recent_page) }}" class="pagination-btn">Previous</a>
                            {% else %}
                                <span class="pagination-btn disabled">Previous</span>
                            {% endif %}

                            {% for p in range(1, popular_total_pages + 1) %}
                                {% if p == popular_page %}
                                    <span class="pagination-btn active">{{ p }}</span>
                                {% else %}
                                    <a href="{{ url_for('index', popular_page=p, recent_page=recent_page) }}" class="pagination-btn">{{ p }}</a>
                                {% endif %}
                            {% endfor %}

                            {% if popular_page < popular_total_pages %}
                                <a href="{{ url_for('index', popular_page=popular_page+1, recent_page=recent_page) }}" class="pagination-btn">Next</a>
                            {% else %}
                                <span class="pagination-btn disabled">Next</span>
                            {% endif %}
                        </div>
                    {% else %}
                        <p>No popular searches.</p>
                    {% endif %}
                </div>
            </div>
        </div>
        <div class="input-box">
            <form method="POST" action="/" class="search-form" id="search-form">
                <div class="search-container">
                    <!-- Hacker Logo (Gunakan gambar sesuai keinginan Anda) -->
                    <!-- Anda dapat mengganti src dengan path ke logo hacker Anda -->
                    <img src="https://img.icons8.com/ios-filled/50/ffffff/hacker.png" alt="Hacker Logo" class="hacker-logo">
                    <!-- Search Input -->
                    <input type="text" id="query" name="query" placeholder="e.g., Bitcoin -is:retweet" autocomplete="off">
                    <!-- Search Button -->
                    <button type="submit" class="search-button">🔍 Search</button>
                </div>
                <!-- Search Suggestions Dropdown -->
                <div class="suggestions" id="suggestions" style="display: none;"></div>
            </form>
        </div>
    </div>

    <!-- JavaScript untuk menangani loading screen, pengambilan data chart, switching tipe chart, koneksi wallet, dan search suggestions -->
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            // Handle Loading Screen
            const loadingScreen = document.getElementById("loading-screen");
            const mainContainer = document.querySelector(".container");
            const terminalOutput = document.getElementById("terminal-output");
            const progressBar = document.getElementById("progress-bar");
            const loadingLine = document.getElementById("loading-line");

            // Function to check if pagination parameters are present
            function hasPaginationParams() {
                const urlParams = new URLSearchParams(window.location.search);
                return urlParams.has('popular_page') || urlParams.has('recent_page');
            }

            // Initialize the page
            document.addEventListener("DOMContentLoaded", function() {
                if (hasPaginationParams()) {
                    // Skip the loading screen if pagination parameters are present
                    loadingScreen.style.display = "none";  // Hide the loading screen
                    mainContainer.style.display = "flex"; // Show the main container
                    return;
                }

                // Show the loading screen and start the loading animation
                displayNextLine();
            });

            document.addEventListener("DOMContentLoaded", function() {
                const connectWalletBtn = document.getElementById('connect-wallet-btn');
                const walletAddressText = document.getElementById('wallet-address-text');
                const walletAddressContainer = document.getElementById('wallet-address');
                
                function formatWalletAddress(address) {
                    if (address.length > 10) {
                        return `${address.slice(0, 5)} ... ${address.slice(-5)}`;
                    }
                    return address;
                }

                // Fungsi untuk menampilkan alamat wallet
                function updateWalletAddress(fullAddress) {
                    if (walletAddressDisplay && fullAddress) {
                        walletAddressDisplay.textContent = formatWalletAddress(fullAddress);
                        walletAddressContainer.style.display = 'block'; // Pastikan elemen ditampilkan
                    } else {
                        console.error("Elemen 'wallet-address-text' tidak ditemukan atau alamat tidak valid.");
                    }
                }

                // Simulasi koneksi wallet otomatis
                async function connectWallet() {
                    try {
                        const response = await window.solana.connect();
                        const fullAddress = response.publicKey.toString();
                        console.log("Full Address:", fullAddress);
                        walletAddressText.textContent = formatWalletAddress(fullAddress);
                        walletAddressContainer.style.display = 'block';
                        connectWalletBtn.textContent = 'Logout ⏻';
                    } catch (error) {
                        console.error("Gagal menghubungkan wallet:", error);
                    }
                }

                // Event listener untuk tombol connect wallet
                connectWalletBtn.addEventListener('click', () => {
                    if (connectWalletBtn.textContent.includes('Logout')) {
                        walletAddressContainer.style.display = 'none';
                        walletAddressText.textContent = '';
                        connectWalletBtn.textContent = 'Connect Wallet ⏻';
                    } else {
                        connectWallet();
                    }
                });
            });


            // Lock Overlay
            const lockOverlay = document.getElementById("lock-overlay");
            const lockCloseBtn = document.getElementById("lock-close-btn");

            // Define loading lines based on context
            const isSearch = {{ 'true' if is_search else 'false' }};
            let lines;
            if (isSearch) {
                lines = [
                    "Submitting your search...",
                    "Fetching latest data...",
                    "Updating analytics...",
                    "Rendering results..."
                ];
            } else {
                lines = [
                    "Connecting to Twitter API...",
                    "Fetching trending crypto topics...",
                    "Analyzing tweet sentiments...",
                    "Finalizing data visualization..."
                ];
            }

            let currentLine = 0;

            function typeLine(line, callback) {
                let i = 0;
                loadingLine.textContent = ""; // Clear existing text
                loadingLine.classList.remove("typing"); // Remove typing animation

                // Create a new typing element
                const typingElement = document.createElement("span");
                typingElement.classList.add("typing");
                loadingLine.appendChild(typingElement);

                function typeChar() {
                    if (i < line.length) {
                        typingElement.textContent += line.charAt(i);
                        i++;
                        setTimeout(typeChar, 50); // Adjust typing speed here
                    } else {
                        if (callback) callback();
                    }
                }
                typeChar();
            }

            function updateProgressBar(percentage) {
                progressBar.style.width = `${percentage}%`;
            }

            function displayNextLine() {
                if (currentLine < lines.length) {
                    typeLine(lines[currentLine], () => {
                        currentLine++;
                        updateProgressBar((currentLine / lines.length) * 100);
                        // Small delay before typing the next line
                        setTimeout(displayNextLine, 500);
                    });
                } else {
                    // After all lines are typed, proceed to hide loading screen
                    const delay = Math.floor(Math.random() * 2000) + 3000; // Random delay between 3-5 seconds
                    setTimeout(() => {
                        // Fade out loading screen
                        loadingScreen.style.transition = "opacity 1s ease";
                        loadingScreen.style.opacity = "0";
                        setTimeout(() => {
                            loadingScreen.style.display = "none";
                            mainContainer.style.display = "flex";
                            checkWalletConnection(); // Check wallet connection after loading
                        }, 1000); // Wait for the fade-out transition to complete
                    }, delay);
                }
            }

            displayNextLine();

            // Initialize Chart.js
            let tweetChart; // Declare globally
            let currentChartType = ''; // No default chart type selected

            // Predefined colors for datasets
            const chartColors = [
                'rgba(255, 99, 132, 1)',   // Red
                'rgba(54, 162, 235, 1)',   // Blue
                'rgba(255, 206, 86, 1)',   // Yellow
                'rgba(75, 192, 192, 1)',   // Green
                'rgba(153, 102, 255, 1)',  // Purple
                'rgba(255, 159, 64, 1)'    // Orange
            ];

            // Function to initialize the chart
            function initializeChart(type, labels, datasets) {
                const ctx = document.getElementById('tweetChart').getContext('2d');
                
                // Destroy existing chart if it exists
                if (tweetChart) {
                    tweetChart.destroy();
                }
                
                // Create new chart
                tweetChart = new Chart(ctx, {
                    type: type,
                    data: {
                        labels: labels,
                        datasets: datasets
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false, // Allows the chart to adjust based on container size
                        plugins: {
                            legend: {
                                display: false // We'll create a custom legend
                            },
                            title: {
                                display: true,
                                text: type === 'doughnut' ? 'Tweet Count Distribution' : 'Tweet Analytics',
                                color: 'lime',
                                font: {
                                    size: 16,
                                    weight: 'bold'
                                }
                            }
                        },
                        scales: type !== 'doughnut' ? { // Only add scales if not doughnut
                            x: {
                                title: {
                                    display: true,
                                    text: 'Date',
                                    color: 'lime'
                                },
                                ticks: {
                                    color: 'lime'
                                },
                                grid: {
                                    color: 'rgba(0, 255, 0, 0.2)'
                                }
                            },
                            y: {
                                title: {
                                    display: true,
                                    text: 'Tweet Count',
                                    color: 'lime'
                                },
                                ticks: {
                                    color: 'lime'
                                },
                                grid: {
                                    color: 'rgba(0, 255, 0, 0.2)'
                                }
                            }
                        } : {},
                        layout: {
                            padding: {
                                top: 20,
                                bottom: 20,
                                left: 20,
                                right: 20
                            }
                        },
                        // Additional options for donut chart to control the size
                        cutout: type === 'doughnut' ? '50%' : '0%' // Adjust the cutout size for donut
                    }
                });
            }

            // Function to fetch data for a query
            function fetchData(query) {
                return fetch(`/data/${encodeURIComponent(query)}`)
                    .then(response => {
                        if (!response.ok) {
                            return response.json().then(errData => { throw new Error(errData.error || 'Unknown error'); });
                        }
                        return response.json();
                    })
                    .then(data => {
                        return data.data;
                    });
            }

            // Function to update the chart with selected queries
            async function updateChart(selectedQueries) {
                try {
                    if (selectedQueries.length === 0) {
                        if (tweetChart) {
                            tweetChart.destroy();
                            tweetChart = null;
                        }
                        document.getElementById('chart-legend').innerHTML = '';
                        return;
                    }

                    if (currentChartType === 'doughnut') {
                        // Aggregate total tweet counts per query
                        let aggregatedData = [];
                        for (let query of selectedQueries) {
                            let data = await fetchData(query);
                            let total = data.reduce((sum, entry) => sum + parseInt(entry.tweet_count), 0);
                            aggregatedData.push({ query: query, total: total });
                        }

                        // Prepare data for Donut Chart
                        const labels = aggregatedData.map(item => item.query);
                        const dataValues = aggregatedData.map(item => item.total);
                        const backgroundColors = aggregatedData.map((_, index) => chartColors[index % chartColors.length]);

                        const datasets = [{
                            data: dataValues,
                            backgroundColor: backgroundColors,
                            borderColor: 'rgba(0,0,0,0)', // Remove borders between segments
                            borderWidth: 1
                        }];

                        initializeChart('doughnut', labels, datasets);
                        updateLegend(selectedQueries);
                    } else if (currentChartType === 'line' || currentChartType === 'bar') {
                        // Handle Line and Bar Charts: Time-series data per query
                        // Determine the union of all dates
                        const allData = await Promise.all(selectedQueries.map(query => fetchData(query)));
                        const dateSet = new Set();
                        allData.forEach(data => {
                            data.forEach(entry => dateSet.add(entry.start));
                        });
                        const sortedDates = Array.from(dateSet).sort();

                        // Format dates to DD-MM-YY
                        const formattedDates = sortedDates.map(dateStr => {
                            let dt = new Date(dateStr);
                            let day = dt.getDate().toString().padStart(2, '0');
                            let month = (dt.getMonth() + 1).toString().padStart(2, '0');
                            let year = dt.getFullYear().toString().slice(-2);
                            return `${day}-${month}-${year}`;
                        });

                        const labels = formattedDates;

                        // Prepare datasets
                        const datasets = allData.map((data, index) => {
                            const query = selectedQueries[index];
                            const tweetCounts = sortedDates.map(date => {
                                const entry = data.find(d => d.start === date);
                                return entry ? parseInt(entry.tweet_count) : 0;
                            });

                            return {
                                label: query,
                                data: tweetCounts,
                                borderColor: chartColors[index % chartColors.length],
                                backgroundColor: chartColors[index % chartColors.length],
                                fill: currentChartType === 'line' ? false : true, // Fill for bar charts
                                tension: 0.1
                            };
                        });

                        initializeChart(currentChartType, labels, datasets);
                        updateLegend(selectedQueries);
                    }
                } catch (error) {
                    alert(`[ERROR] ${error.message}`);
                }
            }

            // Function to update the legend
            function updateLegend(selectedQueries) {
                const legendContainer = document.getElementById('chart-legend');
                legendContainer.innerHTML = ''; // Clear existing legend

                if (currentChartType === 'doughnut') {
                    // For Donut Chart, display color boxes dengan label query
                    selectedQueries.forEach((query, index) => {
                        const color = chartColors[index % chartColors.length];
                        const legendItem = document.createElement('div');
                        legendItem.classList.add('legend-item');

                        const colorBox = document.createElement('span');
                        colorBox.classList.add('legend-color');
                        colorBox.style.backgroundColor = color;

                        const label = document.createElement('span');
                        label.textContent = query;

                        legendItem.appendChild(colorBox);
                        legendItem.appendChild(label);
                        legendContainer.appendChild(legendItem);
                    });
                } else if (currentChartType === 'line' || currentChartType === 'bar') {
                    // For Line and Bar Charts, display color boxes dengan label query
                    selectedQueries.forEach((query, index) => {
                        const color = chartColors[index % chartColors.length];
                        const legendItem = document.createElement('div');
                        legendItem.classList.add('legend-item');

                        const colorBox = document.createElement('span');
                        colorBox.classList.add('legend-color');
                        colorBox.style.backgroundColor = color;

                        const label = document.createElement('span');
                        label.textContent = query;

                        legendItem.appendChild(colorBox);
                        legendItem.appendChild(label);
                        legendContainer.appendChild(legendItem);
                    });
                }
            }

            // Handle Checkbox Changes
            const checkboxes = document.querySelectorAll(".compare-checkbox");
            checkboxes.forEach(checkbox => {
                checkbox.addEventListener("change", function() {
                    const selectedQueries = Array.from(checkboxes)
                        .filter(cb => cb.checked)
                        .map(cb => cb.getAttribute("data-query"));

                    if (selectedQueries.length > 0 && currentChartType) {
                        updateChart(selectedQueries);
                    } else {
                        if (tweetChart) {
                            tweetChart.destroy();
                            tweetChart = null;
                        }
                        document.getElementById('chart-legend').innerHTML = '';
                    }
                });
            });

            // Handle Chart Type Selection via Dropdown
            const chartTypeSelect = document.getElementById('chartTypeSelect');
            chartTypeSelect.addEventListener('change', function() {
                currentChartType = this.value;
                const selectedQueries = Array.from(checkboxes)
                    .filter(cb => cb.checked)
                    .map(cb => cb.getAttribute("data-query"));

                if (selectedQueries.length > 0 && currentChartType) {
                    updateChart(selectedQueries);
                } else {
                    if (tweetChart) {
                        tweetChart.destroy();
                        tweetChart = null;
                    }
                    document.getElementById('chart-legend').innerHTML = '';
                }
            });

            // Handle Existing Plot Button Clicks (if any)
            const plotButtons = document.querySelectorAll(".show-plot-btn");
            plotButtons.forEach(button => {
                button.addEventListener("click", function() {
                    const query = this.getAttribute("data-query");
                    // Uncheck all checkboxes dan centang yang sesuai dengan tombol yang diklik
                    checkboxes.forEach(cb => cb.checked = false);
                    const targetCheckbox = Array.from(checkboxes).find(cb => cb.getAttribute("data-query") === query);
                    if (targetCheckbox) {
                        targetCheckbox.checked = true;
                        // Jika tipe chart sudah dipilih, perbarui chart
                        if (currentChartType) {
                            updateChart([query]);
                        } else {
                            alert("Silakan pilih tipe chart terlebih dahulu.");
                        }
                    }
                });
            });

            /* Solana Wallet Integration */
            const connectWalletBtn = document.getElementById('connect-wallet-btn');
            const walletAddressDisplay = document.getElementById('wallet-address');
            const walletAddressText = document.getElementById('wallet-address-text');
            const retroPointDisplay = document.getElementById('retro-point');

            // Function to display wallet address dan points
            function displayWalletAddress(address, points) {
                walletAddressText.textContent = address;
                walletAddressDisplay.style.display = 'block';
                retroPointDisplay.textContent = `Retro Point: ${points}`;
                connectWalletBtn.textContent = 'Logout ⏻'; // Ubah teks tombol menjadi "Logout"
                lockOverlay.style.display = 'none'; // Unlock the search feature
                sessionStorage.setItem('wallet_connected', 'true');
            }

            // Function to hide wallet address dan reset button
            function hideWalletAddress() {
                walletAddressText.textContent = '';
                walletAddressDisplay.style.display = 'none';
                retroPointDisplay.textContent = 'Retro Point: 0';
                connectWalletBtn.textContent = 'Connect Wallet ⏻';
                lockOverlay.style.display = 'none'; // Ensure lock overlay is hidden
                sessionStorage.setItem('wallet_connected', 'false');
            }

            // Close button untuk overlay
            lockCloseBtn.addEventListener('click', function() {
                lockOverlay.style.display = 'none';
            });

            // Check if Phantom wallet is installed
            function isPhantomInstalled() {
                return window.solana && window.solana.isPhantom;
            }

            // Connect to Phantom Wallet
            async function connectWallet() {
                if (!isPhantomInstalled()) {
                    alert('Phantom wallet tidak terpasang. Silakan pasang dari https://phantom.app/');
                    return;
                }

                try {
                    const resp = await window.solana.connect();
                    const walletAddress = resp.publicKey.toString();
                    // Send wallet address to the server
                    const response = await fetch('/connect_wallet', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ wallet_address: walletAddress })
                    });

                    if (response.ok) {
                        const data = await response.json();
                        displayWalletAddress(walletAddress, data.points);
                    } else {
                        const errorData = await response.json();
                        alert(`[ERROR] ${errorData.error}`);
                        console.error(errorData.error);
                    }
                } catch (err) {
                    console.error(err);
                }
            }

            // Disconnect from Phantom Wallet
            async function disconnectWallet() {
                try {
                    await window.solana.disconnect();
                    // Notify the server about disconnection
                    await fetch('/disconnect_wallet', {
                        method: 'POST'
                    });
                    hideWalletAddress();
                } catch (err) {
                    console.error(err);
                }
            }

            // Event listener untuk tombol Connect Wallet
            connectWalletBtn.addEventListener('click', function() {
                if (walletAddressText.textContent) {
                    // Jika sudah terhubung, putuskan koneksi
                    disconnectWallet();
                } else {
                    // Jika belum terhubung, hubungkan
                    connectWallet();
                }
            });

            // Automatically connect if already connected
            async function checkWalletConnection() {
                console.log("Checking wallet connection...");
                if (isPhantomInstalled()) {
                    console.log("Phantom Wallet is installed.");
                    try {
                        const resp = await window.solana.connect({ onlyIfTrusted: true });
                        console.log("Connected to wallet:", resp.publicKey.toString());
                        const walletAddress = resp.publicKey.toString();
                        // Send wallet address to the server
                        const response = await fetch('/connect_wallet', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({ wallet_address: walletAddress })
                        });

                        if (response.ok) {
                            const data = await response.json();
                            console.log("Wallet connected successfully:", walletAddress, "Points:", data.points);
                            displayWalletAddress(walletAddress, data.points);
                        } else {
                            console.error("Failed to connect wallet on server.");
                            hideWalletAddress();
                        }
                    } catch (err) {
                        console.warn("Wallet connection failed or not trusted.");
                        hideWalletAddress();
                    }

                    // Listen for account changes
                    window.solana.on("accountChanged", async (newPublicKey) => {
                        if (newPublicKey) {
                            const walletAddress = newPublicKey.toString();
                            console.log("Wallet account changed:", walletAddress);
                            // Send wallet address to the server
                            const response = await fetch('/connect_wallet', {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json'
                                },
                                body: JSON.stringify({ wallet_address: walletAddress })
                            });

                            if (response.ok) {
                                const data = await response.json();
                                console.log("Wallet reconnected successfully:", walletAddress, "Points:", data.points);
                                displayWalletAddress(walletAddress, data.points);
                            }
                        } else {
                            console.log("Wallet disconnected.");
                            hideWalletAddress();
                        }
                    });
                } else {
                    console.log("Phantom Wallet is not installed.");
                    // Optional: Tampilkan pesan atau opsi untuk memasang Phantom Wallet
                    // Misalnya, tambahkan tombol untuk mengunduh Phantom Wallet
                }
            }

            /* Search Suggestions Implementation */
            const searchInput = document.getElementById('query');
            const suggestionsContainer = document.getElementById('suggestions');

            // Debounce function to limit the rate of API calls
            function debounce(func, delay) {
                let timeout;
                return function(...args) {
                    clearTimeout(timeout);
                    timeout = setTimeout(() => func.apply(this, args), delay);
                };
            }

            // Function to fetch and display suggestions
            async function fetchSuggestions(query) {
                if (!query) {
                    suggestionsContainer.style.display = 'none';
                    suggestionsContainer.innerHTML = '';
                    return;
                }

                try {
                    const response = await fetch(`/suggest?q=${encodeURIComponent(query)}`);
                    if (!response.ok) {
                        throw new Error('Failed to fetch suggestions.');
                    }
                    const data = await response.json();
                    displaySuggestions(data.suggestions);
                } catch (error) {
                    console.error(error);
                }
            }

            // Function to display suggestions in the dropdown
            function displaySuggestions(suggestions) {
                if (suggestions.length === 0) {
                    suggestionsContainer.style.display = 'none';
                    suggestionsContainer.innerHTML = '';
                    return;
                }

                suggestionsContainer.innerHTML = ''; // Clear previous suggestions

                suggestions.forEach(suggestion => {
                    const item = document.createElement('div');
                    item.classList.add('suggestion-item');
                    item.textContent = `${suggestion.query} (Hype #${suggestion.rank})`;
                    item.addEventListener('click', () => {
                        searchInput.value = suggestion.query;
                        suggestionsContainer.style.display = 'none';
                        suggestionsContainer.innerHTML = '';
                    });
                    suggestionsContainer.appendChild(item);
                });

                suggestionsContainer.style.display = 'block';
            }

            // Attach debounced input event listener
            searchInput.addEventListener('input', debounce(function() {
                const query = this.value;
                fetchSuggestions(query);
            }, 300)); // Adjust debounce delay as needed

            // Hide suggestions when clicking outside
            document.addEventListener('click', function(event) {
                if (!searchInput.contains(event.target) && !suggestionsContainer.contains(event.target)) {
                    suggestionsContainer.style.display = 'none';
                    suggestionsContainer.innerHTML = '';
                }
            });

            /* Disable Search Form Until Wallet is Connected */
            // Event listener untuk form submission
            const searchFormElement = document.getElementById("search-form");
            searchFormElement.addEventListener("submit", function(event) {
                const walletConnected = sessionStorage.getItem('wallet_connected') === 'true';
                if (!walletConnected) {
                    event.preventDefault();
                    lockOverlay.style.display = 'flex';
                }
            });

            /* Ensure that the lock overlay is not displayed on initial load */
            // Existing code already hides the lock overlay initially

            /* Initialize System Status */
            // System Status Loading Animation
            function simulateLoading() {
                const loadingProgress = document.getElementById('loading-progress');
                let percentage = 0;
                
                const loadingInterval = setInterval(() => {
                    // Increment percentage randomly between 1 and 5
                    percentage += Math.floor(Math.random() * 5) + 1;
                    if (percentage >= 100) {
                        percentage = 100;
                        clearInterval(loadingInterval);
                    }
                    loadingProgress.style.width = `${percentage}%`;
                    loadingProgress.textContent = `${percentage}%`;
                }, 500); // Adjust interval as needed
            }

            // API Status Response Time
            function updateAPIStatus() {
                const apiResponseTime = document.getElementById('api-response-time');
                setInterval(() => {
                    const randomTime = Math.floor(Math.random() * (67 - 5 + 1)) + 5; // Random between 5 and 67
                    apiResponseTime.textContent = `${randomTime}ms`;
                }, 1000); // Update every second
            }

            // Initialize System Status
            simulateLoading();
            updateAPIStatus();

            /* Existing code... */
        }); 

    </script>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            function getRandomInt(min, max) {
                return Math.floor(Math.random() * (max - min + 1)) + min;
            }
    
            function updateSystemStatus() {
                // Update CPU Load
                const cpuLoad = getRandomInt(1, 100);
                const cpuStatus = document.getElementById("cpu-load-status");
                cpuStatus.textContent = `${cpuLoad}%`;
                cpuStatus.className = "status-text"; // Reset classes
                if (cpuLoad < 70) {
                    cpuStatus.classList.add("blinking-green");
                } else if (cpuLoad < 90) {
                    cpuStatus.classList.add("blinking-yellow");
                } else {
                    cpuStatus.classList.add("blinking-red");
                }
    
                // Update Active Connections
                const connections = getRandomInt(10, 500);
                const connectionsStatus = document.getElementById("connections-status");
                connectionsStatus.textContent = connections;
                connectionsStatus.className = "status-text"; // Reset classes
                if (connections < 300) {
                    connectionsStatus.classList.add("blinking-green");
                } else if (connections < 450) {
                    connectionsStatus.classList.add("blinking-yellow");
                } else {
                    connectionsStatus.classList.add("blinking-red");
                }
    
                // Update AI Engine
                const aiLoad = getRandomInt(1, 100);
                const aiResponseTime = getRandomInt(20, 100);
                const aiLoadStatus = document.getElementById("ai-engine-load");
                const aiResponseStatus = document.getElementById("ai-engine-response-time");
                const aiEngineStatus = document.getElementById("ai-engine-status");
    
                aiLoadStatus.textContent = `${aiLoad}%`;
                aiResponseStatus.textContent = `${aiResponseTime}ms`;
                aiEngineStatus.className = "status-text"; // Reset classes
                if (aiLoad < 70) {
                    aiEngineStatus.textContent = "[🟢] Operational";
                    aiEngineStatus.classList.add("blinking-green");
                } else if (aiLoad < 90) {
                    aiEngineStatus.textContent = "[🟡] High Load";
                    aiEngineStatus.classList.add("blinking-yellow");
                } else {
                    aiEngineStatus.textContent = "[🔴] Critical";
                    aiEngineStatus.classList.add("blinking-red");
                }
    
                // Update Queue
                const queueLength = getRandomInt(0, 50); // Random queue length
                const processingSpeed = getRandomInt(10, 100); // Random processing speed
                const nextItem = queueLength > 0 ? `Task ${getRandomInt(1, 1000)}` : "None";

                const queueLengthStatus = document.getElementById("queue-length");
                const processingSpeedStatus = document.getElementById("processing-speed");
                const nextInQueueStatus = document.getElementById("next-in-queue");

                queueLengthStatus.textContent = queueLength;
                processingSpeedStatus.textContent = `${processingSpeed}ms/item`;
                nextInQueueStatus.textContent = nextItem;

                // Optional: Add classes for visual status
                queueLengthStatus.className = "status-text";
                if (queueLength < 20) {
                    queueLengthStatus.classList.add("blinking-green");
                } else if (queueLength < 40) {
                    queueLengthStatus.classList.add("blinking-yellow");
                } else {
                    queueLengthStatus.classList.add("blinking-red");
                }
            }
    
            // Update every 1 second
            setInterval(updateSystemStatus, 1000);
        });
    </script>
    
</body>
</html>
